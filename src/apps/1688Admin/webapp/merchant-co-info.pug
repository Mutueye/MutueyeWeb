extends layout

block content
    .container-fluid.row-space-common
        .row.mt-space
            .col-xs-12
                .page-title 企业信息
            .col-xs-12
                .box-form.has-title.row-space-10
                    .box-form-title 查询条件
                    form.row.no-bottom
                        .col-xs-12.col-sm-6
                            .form-group.cool-form-group.form-group-sm
                                .cool-form-label.text-right.control-label 企业名称：
                                input.form-control(type="text")
                        .col-xs-12.col-sm-6.col-md-6
                            .form-group.cool-form-group.form-group-sm
                                .cool-form-label.text-right.control-label 状态：
                                select.form-control
                                    option 全部
                                    option 意向企业
                                    option 洽谈企业
                                    option 已签合同
                                    option 意向取消
                                    option 合同终止
                                    option 注册未签约
                        .col-xs-12.col-sm-6.col-md-4
                            .form-group.cool-form-group.form-group-sm
                                .cool-form-label.text-right.control-label 接待人：
                                input.form-control(type="text")
                        .col-xs-12.col-sm-6.col-md-4
                            .form-group.cool-form-group.form-group-sm
                                .cool-form-label.text-right.control-label 起始时间：
                                .input-group.date#start_time
                                    input.form-control(type="text")
                                    .btn.btn-line.input-group-addon
                                        i.fa.fa-calendar
                        .col-xs-12.col-sm-6.col-md-4
                            .form-group.cool-form-group.form-group-sm
                                .cool-form-label.text-right.control-label 截止时间：
                                .input-group.date#end_time
                                    input(type="text").form-control
                                    .btn.btn-line.input-group-addon
                                        i.fa.fa-calendar
                        .col-xs-12
                            .btn.btn-line.btn-small
                                i.fa.fa-search
                                |&nbsp;查询
            .col-xs-12
                .toolbar#toolbar
                    .btn.btn-theme#toolbtn_new
                        i.fa.fa-plus
                        |&nbsp;未签约企业录入
                    .btn.btn-theme#toolbtn_new_2
                        i.fa.fa-plus
                        |&nbsp;意向企业录入
                    .btn.btn-theme#toolbtn_new_3
                        i.fa.fa-plus
                        |&nbsp;企业录入
                    .btn.btn-theme#toolbtn_edit
                        i.fa.fa-edit
                        |&nbsp;编辑
                    .btn.btn-theme#toolbtn_remove
                        i.fa.fa-remove
                        |&nbsp;删除
                table#table

                    
block js
    script(src='../js/jquery.min.js')
    script(src='../js/bootstrap.min.js')
    script(src='../js/moment/moment.min.js')
    script(src='../js/moment/zh-cn.js')
    script(src='../js/bootstrap-datetimepicker.min.js')
    script(src='../js/bootstrap-table/bootstrap-table.min.js')
    script(src='../js/bootstrap-table/bootstrap-table-zh-CN.min.js')
    script(src='../js/toastr.min.js')
    script(src='../js/ewin.js')
    script(src=JS_DIR + 'common.js')
    script(src='../js/app.js')
    script(type='text/javascript').
        $(document).ready(function(){
            
            var $startTime = $('#start_time');
            var $endTime = $('#end_time');
            
            var $btn_remove = $('#toolbtn_remove');
            var $btn_edit = $('#toolbtn_edit');
            var $table = $('#table');
            
            var editHtml = "<div class='row-space-10'>" +
                                "<div class='row no-bottom'>" +
                                    "<div class='col-xs-12'>" +
                                        "<div class='form-group form-group-sm cool-form-group'>" +
                                            "<div class='control-label cool-form-label text-right'>企业名称：</div>" +
                                            "<input class='form-control' type='text' id='editform_org_name'>" + 
                                        "</div>" +
                                    "</div>" +
                                    "<div class='col-xs-12'>" +
                                        "<div class='form-group form-group-sm cool-form-group'>" +
                                            "<div class='control-label cool-form-label text-right'>企业性质：</div>" +
                                            "<select class='form-control' id='editform_org_prop'>" +
                                                "<option>国有企业</option>" +
                                                "<option>集体企业</option>" +
                                                "<option>私有企业</option>" +
                                                "<option>股份制</option>" +
                                            "</select>" +
                                        "</div>" +
                                    "</div>" +
                                    "<div class='col-xs-12'>" +
                                        "<div class='form-group form-group-sm cool-form-group'>" +
                                            "<div class='control-label cool-form-label text-right'>企业行业：</div>" +
                                            "<select class='form-control' id='editform_org_ind'>" +
                                                "<option>高新科技企业</option>" +
                                                "<option>纺织业</option>" +
                                                "<option>制造业</option>" +
                                            "</select>" +
                                        "</div>" +
                                    "</div>" +
                                    "<div class='col-xs-12'>" +
                                        "<div class='form-group form-group-sm cool-form-group'>" +
                                            "<div class='control-label cool-form-label text-right'>企业法人：</div>" +
                                            "<input class='form-control' type='text' id='editform_org_owner'>" + 
                                        "</div>" +
                                    "</div>" +
                                    "<div class='col-xs-12'>" +
                                        "<div class='form-group form-group-sm cool-form-group'>" +
                                            "<div class='control-label cool-form-label text-right'>联系方式：</div>" +
                                            "<input class='form-control' type='text' id='editform_org_contact'>" + 
                                        "</div>" +
                                    "</div>" +
                                    "<div class='col-xs-12'>" +
                                        "<div class='form-group form-group-sm cool-form-group'>" +
                                            "<div class='control-label cool-form-label text-right'>企业状态：</div>" +
                                            "<select class='form-control' id='editform_org_state'>" +
                                                "<option>有意向</option>" +
                                                "<option>洽谈中</option>" +
                                                "<option>已签合同</option>" +
                                            "</select>" +
                                        "</div>" +
                                    "</div>" +
                                    "<div class='col-xs-12'>" +
                                        "<div class='form-group form-group-sm cool-form-group'>" +
                                            "<div class='control-label cool-form-label text-right'>营业执照：</div>" +
                                            "<div class='cool-form-image'>" +
                                                "<img src='http://img.jdzj.com/UserDocument/2015b/zhonglongky/Picture/20151023111322.jpg'>" +
                                            "</div>"+
                                            "<input class='form-control' type='file' id='editform_org_license'>" + 
                                        "</div>" +
                                    "</div>" +
                                "</div>" +
                            "</div>";
            
            //设置时间输入框
            function setDateTimeInput() {
                //发布起始日期
                $startTime.datetimepicker({
                    viewMode: 'days',
                    format: 'YYYY-MM-DD',
                    allowInputToggle: true
                });
                //发布截止日期
                $endTime.datetimepicker({
                    viewMode: 'days',
                    format: 'YYYY-MM-DD',
                    allowInputToggle: true,
                    useCurrent: false //关联两个日期输入框是，需要设置截止日期的useCurrent:false
                });
                //关联起始和截止日期，使起始日期不晚于截止日期
                $startTime.on("dp.change", function (e) {
                    $endTime.data("DateTimePicker").minDate(e.date);
                });
                //关联起始和截止日期，使截止日期不早于起始日期
                $endTime.on("dp.change", function (e) {
                    $startTime.data("DateTimePicker").maxDate(e.date);
                });
            }
            
            //设置bootstrap-table插件
            function setBSTable() {
                $table.bootstrapTable({
                    toolbar : '#toolbar',
                    showColumns : true,
                    showToggle : true,
                    pagination : true,
                    showPaginationSwitch : false,
                    clickToSelect : true,
                    columns: [
                        {
                            field: 'check',
                            checkbox: true,
                            align: 'center',
                            valign: 'middle'
                        },
                        {
                            field: 'id',
                            title: '序号',
                            sortable: true,
                            halign: 'center',
                            align: 'right',
                            width: 30
                        }, 
                        {
                            field: 'title',
                            title: '公司名称',
                            halign: 'center'
                        }, 
                        {
                            field: 'state',
                            title: '状态',
                            halign: 'center',
                            sortable: true
                        }, 
                        {
                            field: 'name',
                            title: '接待人',
                            halign: 'center'
                        }, 
                        {
                            field: 'date',
                            title: '时间',
                            halign: 'center',
                            sortable: true
                        }
                    ],
                    data: [
                        {
                            id: 1,
                            title: '企业名称1',
                            state: '有意向',
                            name: '周吴郑',
                            date: '2017.06.23'
                        }, 
                        {
                            id: 2,
                            title: '企业名称2',
                            state: '洽谈中',
                            name: '任水寒',
                            date: '2017.07.11'
                        }, 
                        {
                            id: 3,
                            title: '企业名称3',
                            state: '已签合同',
                            name: '苏普',
                            date: '2017.07.11'
                        }, 
                        {
                            id: 4,
                            title: '企业名称4',
                            state: '洽谈中',
                            name: '李晟闻',
                            date: '2017.07.11'
                        }, 
                        {
                            id: 5,
                            title: '企业名称5',
                            state: '审核未通过',
                            name: '岳叔华',
                            date: '2017.07.11'
                        }, 
                        {
                            id: 6,
                            title: '企业名称6',
                            state: '意向取消',
                            name: '侯善稚',
                            date: '2017.07.11'
                        }, 
                        {
                            id: 7,
                            title: '企业名称7',
                            state: '注册未签约',
                            name: '何望',
                            date: '2017.07.11'
                        }, 
                        {
                            id: 8,
                            title: '企业名称8',
                            state: '有意向',
                            name: '陈韵瑄',
                            date: '2017.07.11'
                        }, 
                        {
                            id: 9,
                            title: '企业名称9',
                            state: '洽谈中',
                            name: '郭武莱',
                            date: '2017.07.11'
                        }, 
                        {
                            id: 10,
                            title: '企业名称10',
                            state: '有意向',
                            name: '刘飞',
                            date: '2017.07.11'
                        }, 
                        {
                            id: 11,
                            title: '企业名称11',
                            state: '合同终止',
                            name: '王山崎',
                            date: '2017.07.11'
                        }, 
                        {
                            id: 12,
                            title: '企业名称12',
                            state: '注册未签约',
                            name: '王璐',
                            date: '2017.07.11'
                        }, 
                        {
                            id: 13,
                            title: '企业名称13',
                            state: '已签合同',
                            name: '刘来有',
                            date: '2017.07.11'
                        }, 
                        {
                            id: 14,
                            title: '企业名称14',
                            state: '有意向',
                            name: '王越建',
                            date: '2017.07.11'
                        }, 
                        {
                            id: 15,
                            title: '企业名称15',
                            state: '有意向',
                            name: '尚文清',
                            date: '2017.07.11'
                        }
                    ]
                });
                
                setToolBtnDisableState();
                $table.on('check.bs.table uncheck.bs.table check-all.bs.table uncheck-all.bs.table', function () {
                    setToolBtnDisableState();
                    // save your data, here just save the current page
                    //selections = getIdSelections();
                    // push or splice the selections if you want to save all data selections
                });
                
                //删除操作
                $btn_remove.click(function () {
                    //按钮如果不是disabled状态,则可进行操作
                    if(!$(this).attr('disabled')) {
                        //取表格的选中行数据
                        var arrselections = $table.bootstrapTable('getSelections');
                        if (arrselections.length <= 0) {
                            toastr.warning('请选择有效数据');
                            return;
                        }
     
                        Ewin.confirm({ message: "确认要删除选择的数据吗？" }).on(function (e) {
                            if (!e) {
                                return;
                            }
                            //示例：通过ajax删除数据
                            /*
                            $.ajax({
                                type: "post",
                                url: "/api/.../delete",//删除数据的api地址
                                data: { "": JSON.stringify(arrselections) },
                                success: function (data, status) {
                                    if (status == "success") {
                                        toastr.success('删除的数据已提交成功！');
                                        
                                        //此处可以直接刷新表格
                                        $table.bootstrapTable('refresh');
                                        
                                        //或者在前端删除对应选中的数据条目，并重新设置工具栏按钮的disabled状态
                                        var ids = getIdSelections();
                                        $table.bootstrapTable('remove', {
                                            field: 'id',
                                            values: ids
                                        });
                                        setToolBtnDisableState();
                                    }
                                },
                                error: function () {
                                    toastr.error('Error');
                                },
                                complete: function () {
     
                                }
                            });*/
                            
                            //此处仅是前端演示删除后的效果：删除表格条目，重置工具栏状态，显示删除成功的提示
                            var ids = getIdSelections();
                            $table.bootstrapTable('remove', {
                                field: 'id',
                                values: ids
                            });
                            setToolBtnDisableState();
                            toastr.success('删除的数据已提交成功！');
                            
                        });
                    }
                });
                
                //编辑按钮操作
                $btn_edit.click(function () {
                    if(!$(this).attr('disabled')) {
                        //取表格的选中行数据
                        var arrselections = $table.bootstrapTable('getSelections');
                        if (arrselections.length <= 0) {
                            toastr.warning('请选择有效数据');
                            return;
                        }
                        alert(JSON.stringify(arrselections));
                        //根据选定的数据信息打开编辑弹窗
                        Ewin.confirm({ title:"编辑企业", btnok:"提交修改", message:editHtml, width:"600px", btnok_dismiss:false}).on(function (e, id) {
                            if (!e) {
                                return;
                            }
                            
                            //alert($('#'+id).find('#no_pass_reason').eq(0).val());
                            
                            //if($('#'+id).find('#no_pass_reason').eq(0).val().length == 0) {
                                //toastr.warning('请输入审核不通过理由');
                            //} else {
                                //提交审核不通过数据...
                                
                                //此处仅是前端演示提交成功后的效果：跳转回上级页面
                                //window.location.href='merchant-info.html';
                                
                                //如审核通过提交失败，弹出提示消息
                                //toastr.error('提交审核不通过信息失败，请重试');
                            //}
                            
                            
                        });
                    }
                });
            }
            
            function getIdSelections() {
                return $.map($table.bootstrapTable('getSelections'), function (row) {
                    return row.id
                });
            }
            
            function setToolBtnDisableState() {
                $btn_remove.attr('disabled', !$table.bootstrapTable('getSelections').length);
                $btn_edit.attr('disabled', $table.bootstrapTable('getSelections').length != 1);
            }
            
            setDateTimeInput();
            setBSTable();
            
        });



